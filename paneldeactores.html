<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel de Actores - Castingred</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

// Configuración de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBQmYwkqr29lvaF8ew3BJ2suc5UxRaVU1Y",
  authDomain: "castingred-a6f6e.firebaseapp.com",
  projectId: "castingred-a6f6e",
  storageBucket: "castingred-a6f6e.appspot.com",
  messagingSenderId: "61701399093",
  appId: "1:61701399093:web:678b77ff06ce83e1a1077c",
  measurementId: "G-J1QPG9HXGZ"
};

// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();

// Verificar sesión de administrador
onAuthStateChanged(auth, (user) => {
  if (!user || user.email !== "vm20936@gmail.com") {
    window.location.href = "admin-login.html";
  }
});

// Logout
document.addEventListener("DOMContentLoaded", () => {
  const btnLogout = document.getElementById("logoutBtn");
  if (btnLogout) {
    btnLogout.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "admin-login.html";
    });
  }
});

// Cargar listas de actores
document.addEventListener("DOMContentLoaded", () => {
  const listaPendientes = document.getElementById("listaPendientes");
  const listaAprobados = document.getElementById("listaAprobados");
  const listaRechazados = document.getElementById("listaRechazados");

  onSnapshot(collection(db, "actores"), (snapshot) => {
    listaPendientes.innerHTML = "";
    listaAprobados.innerHTML = "";
    listaRechazados.innerHTML = "";

    snapshot.forEach(docSnap => {
      const actor = docSnap.data();
      const div = document.createElement("div");
      div.className = "perfil";
      div.innerHTML = `
        <h3>${actor.nombreCompleto}</h3>
        <p><strong>Edad:</strong> ${actor.edad}</p>
        <p><strong>Género:</strong> ${actor.genero}</p>
        <p><strong>Teléfono:</strong> ${actor.telefono}</p>
        <p><strong>Correo:</strong> ${actor.correo}</p>
        <p><strong>Experiencia:</strong> ${actor.experiencia || '-'}</p>
        <p><strong>Rol preferido:</strong> ${actor.rolPreferido || '-'}</p>
        <p><strong>Portafolio digital:</strong> ${actor.portafolioDigital ? `<a href="${actor.portafolioDigital}" target="_blank">Ver portafolio</a>` : '-'}</p>
        <p><strong>Estado:</strong> <span id="estado-${docSnap.id}">${actor.estado || 'Pendiente'}</span></p>
        <div class="botones">
          <button onclick="cambiarEstado('${docSnap.id}', 'Aprobado')" class="aprobar">Aprobar</button>
          <button onclick="cambiarEstado('${docSnap.id}', 'Rechazado')" class="rechazar">Rechazar</button>
        </div>
      `;

      if(actor.estado === "Aprobado") {
        listaAprobados.appendChild(div);
      } else if(actor.estado === "Rechazado") {
        listaRechazados.appendChild(div);
      } else {
        listaPendientes.appendChild(div);
      }
    });
  });
});

// Cambiar estado de actor
window.cambiarEstado = async (id, nuevoEstado) => {
  const actorRef = doc(db, "actores", id);
  await updateDoc(actorRef, { estado: nuevoEstado });
};
</script>

<style>
body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg,#e0f7fa,#e1bee7); padding:40px 20px; min-height:100vh;}
h2 { text-align:center; color:#333; margin-bottom:20px; font-size:2rem; }
h3 { color:#007bff; margin:0 0 10px 0; }
p { margin:5px 0; color:#555; font-size:0.95rem; }
#contenedorListas { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }
.lista { background:white; padding:20px; border-radius:15px; box-shadow:0 8px 20px rgba(0,0,0,0.1); width:300px; }
.perfil { background:#f7f7f7; padding:15px; border-radius:12px; margin-bottom:10px; }
.botones { display:flex; gap:10px; margin-top:10px; }
button { padding:6px 10px; border-radius:8px; border:none; font-weight:bold; cursor:pointer; }
button.aprobar { background-color:#28a745; color:white; }
button.aprobar:hover { background-color:#218838; }
button.rechazar { background-color:#dc3545; color:white; }
button.rechazar:hover { background-color:#c82333; }
#logoutBtn { background-color:#ff7e5f; color:white; padding:8px 12px; margin-bottom:20px; border:none; border-radius:10px; cursor:pointer; }
#logoutBtn:hover { background-color:#ff5a36; }
@media(max-width:900px){#contenedorListas{flex-direction:column;align-items:center;}}
</style>
</head>
<body>
<h2>Panel de Actores</h2>
<button id="logoutBtn">Cerrar sesión</button>
<div id="contenedorListas">
  <div class="lista">
    <h3>Pendientes</h3>
    <div id="listaPendientes"></div>
  </div>
  <div class="lista">
    <h3>Aprobados</h3>
    <div id="listaAprobados"></div>
  </div>
  <div class="lista">
    <h3>Rechazados</h3>
    <div id="listaRechazados"></div>
  </div>
</div>
</body>
</html>
